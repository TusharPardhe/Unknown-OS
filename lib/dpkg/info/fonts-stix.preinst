#!/bin/sh

set -e

rm_conffile() {
  PKGNAME="$1"
  CONFFILE="$2"
  if [ -e "$CONFFILE" ]; then
   md5sum="`md5sum \"$CONFFILE\" | sed -e \"s/ .*//\"`"
   old_md5sum="`dpkg-query -W -f='${Conffiles}' $PKGNAME | sed -n -e \"\\\\' $CONFFILE'{s/ obsolete$//;s/.* //p}\"`"
   if [ "$md5sum" != "$old_md5sum" ]; then
     echo "Obsolete conffile $CONFFILE has been modified by you."
     echo "Saving as $CONFFILE.dpkg-bak ..."
     mv -f "$CONFFILE" "$CONFFILE".dpkg-bak
   else
     echo "Removing obsolete conffile $CONFFILE ..."
     rm -f "$CONFFILE"
   fi
 fi
}

pathfind() {
  OLDIFS="$IFS"
  IFS=:
  for p in $PATH; do
    if [ -x "$p/$*" ]; then
      IFS="$OLDIFS"
      return 0
    fi
  done
  IFS="$OLDIFS"
  return 1
}

case "$1" in
install|upgrade)
  if dpkg --compare-versions "$2" lt-nl "0.9~2007.10.31-5"; then
      PKG="otf-stix"
      FILE="/etc/defoma/hints/${PKG}.hints"
      if [ -f $FILE ]; then
          if [ pathfind "defoma-font" = 0 ]; then
	      defoma-font purge-all $FILE || true
	  fi
      fi
    rm_conffile $PKG $FILE
  fi
esac

# dh_installdeb will replace this with shell code automatically
# generated by other debhelper scripts.



exit 0
